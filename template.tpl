___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Kelkoogroup Sales Tracking Tag",
  "categories": ["AFFILIATE_MARKETING", "SALES", "CONVERSIONS"],
  "brand": {
    "id": "kelkoogroup",
    "displayName": "Kelkoo Group",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Include this tag and then add the relevant data in your datalayer as described here : https://www.kelkoogroup.com/kelkoo-customer-service/support-for-merchants/sales-tracking-guides/google-tag-manager-implementation/",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// log to console
const log = require('logToConsole');
log('data =', data);

const injectScript = require('injectScript');
const copyFromDataLayer = require('copyFromDataLayer');
const kkstrack = copyFromDataLayer('kkstrack');

if (kkstrack){
  // Call KK conversion js
  const convurl = 'https://s.kk-resources.com/ks.js';
  const setInWindow = require('setInWindow');
  setInWindow('_kkstrack', kkstrack, true);
  injectScript(convurl, data.gtmOnSuccess, data.gtmOnFailure);
} else {
  // Call KK lead js
  const leadurl = 'https://s.kk-resources.com/leadtag.js';
  injectScript(leadurl, data.gtmOnSuccess, data.gtmOnFailure);
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "kkstrack"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://s.kk-resources.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_kkstrack"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Unit test
  code: "const dataLayer = [{\n\t\t\"kkstrack\": {\n\t\t\t\"merchantInfo\": [{ \"\
    country\":'fr', \"merchantId\":'123456789' }],\n\t\t\t\"orderValue\": '2222222',\n\
    \t\t\t\"orderId\": 'myOrderId123',\n\t\t\t\"channel\": 'kelkoo',\n\t\t\t\"returningUser\"\
    : true,\n\t\t\t\"basket\": [\n\t\t\t\t{\"productname\": 'p1',\"productid\": '1',\"\
    quantity\": '1',\"price\": '4.2'},\n\t        \t{ \"productname\": 'p2',\"productid\"\
    : '2',\"quantity\": '3',\"price\": '8.6'}\n\t\t\t]\n\t\t}\n    }];\n\n// Call\
    \ runCode to run the template's code.\nrunCode(dataLayer);\n\n// Verify that the\
    \ tag finished successfully.\nassertApi('gtmOnSuccess').wasCalled();"


___NOTES___

Created on 26/02/2020 à 15:18:14

